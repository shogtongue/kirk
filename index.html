<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Charlie Kirk Investigation</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    
    :root {
      --bg-primary: #ffffff;
      --bg-secondary: #f8f8f8;
      --text-primary: #000000;
      --text-secondary: #666666;
      --border-color: #e0e0e0;
      --accent-color: #000000;
      /* Heat color system */
      --heat-1: #e8f5e8;   --heat-2: #c8e6c9;   --heat-3: #a5d6a7;   --heat-4: #81c784;
      --heat-5: #fff9c4;   --heat-6: #fff176;   --heat-7: #ffeb3b;
      --heat-8: #ffcdd2;   --heat-9: #ef9a9a;   --heat-10: #e57373;
    }

    /* Dark mode variables */
    [data-theme="dark"] {
      --bg-primary: #1a1a1a;
      --bg-secondary: #2d2d2d;
      --text-primary: #ffffff;
      --text-secondary: #a0a0a0;
      --border-color: #404040;
      --accent-color: #ffffff;
    }

    /* Reset and base styles */
    * {
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg-primary);
      font-family: 'Inter', sans-serif;
      overflow: hidden;
      color: var(--text-primary);
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    /* Start Screen */
    #startScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--bg-primary);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      cursor: pointer;
    }

    #startCircle {
      width: 120px;
      height: 120px;
      border: 3px solid var(--accent-color);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 500;
      text-align: center;
      padding: 20px;
      animation: pulse 2s infinite;
      margin-bottom: 20px;
    }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.8; }
      100% { transform: scale(1); opacity: 1; }
    }

    /* Mobile First Layout */
    #app {
      display: flex;
      flex-direction: column;
      height: 100vh;
      opacity: 0;
      transition: opacity 1s ease;
    }

    .panel {
      background: var(--bg-secondary);
      padding: 16px;
      overflow: auto;
      border: 1px solid var(--border-color);
      transition: background-color 0.3s ease, border-color 0.3s ease;
    }

    #header { 
      background: var(--bg-primary); 
      display: flex; 
      flex-direction: column;
      gap: 12px;
      padding: 12px 16px;
      min-height: auto;
    }

    .header-controls {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    /* Round glowing theme toggle */
    .theme-toggle {
      background: var(--bg-secondary);
      border: 2px solid var(--accent-color);
      border-radius: 50%;
      width: 44px;
      height: 44px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      transition: all 0.3s ease;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    .theme-toggle:hover {
      box-shadow: 0 0 20px var(--accent-color);
      transform: scale(1.1);
    }

    [data-theme="dark"] .theme-toggle {
      box-shadow: 0 0 15px rgba(255,255,255,0.2);
    }

    [data-theme="dark"] .theme-toggle:hover {
      box-shadow: 0 0 25px rgba(255,255,255,0.4);
    }

    #mobileTabs {
      display: flex;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
    }

    .mobile-tab {
      flex: 1;
      padding: 12px;
      background: none;
      border: none;
      font-family: 'Inter', sans-serif;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text-primary);
    }

    .mobile-tab.active {
      background: var(--bg-primary);
      border-bottom: 2px solid var(--accent-color);
    }

    .tab-content {
      flex: 1;
      overflow: auto;
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Tablet Layout */
    @media (min-width: 768px) {
      #app {
        display: grid;
        grid-template-areas: 
          "header header"
          "left center"
          "left right";
        grid-template-columns: 350px 1fr;
        grid-template-rows: 60px 1fr;
        height: 100vh;
      }

      #header { 
        grid-area: header; 
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        padding: 0 24px;
      }

      #leftPanel { 
        grid-area: left; 
        display: block !important;
      }
      #centerPanel { 
        grid-area: center; 
        display: block !important;
      }
      #rightPanel { 
        grid-area: right; 
        display: block !important;
      }

      #mobileTabs {
        display: none;
      }

      .tab-content {
        display: block !important;
      }

      #bottomPanel {
        display: none;
      }
    }

    /* Desktop Layout */
    @media (min-width: 1024px) {
      #app {
        grid-template-areas: 
          "header header header"
          "left center right";
        grid-template-columns: 350px 1fr 400px;
        grid-template-rows: 60px 1fr;
      }
    }

    /* Visualization */
    #visualizationContainer {
      width: 100%;
      height: calc(100% - 70px); /* Make space for controls below */
      position: relative;
      background: var(--bg-primary);
    }

    #networkCanvas {
      display: block;
      width: 100%;
      height: 100%;
    }

    .canvas-overlay {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
    }

    /* Mobile Controls */
    .mobile-controls {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 100;
    }

    .control-pill {
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      padding: 10px 16px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      transition: all 0.2s ease;
      color: var(--text-primary);
    }

    [data-theme="dark"] .control-pill {
      background: rgba(45, 45, 45, 0.95);
    }

    .control-pill:hover {
      background: var(--bg-primary);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    /* Desktop Controls - POSITIONED BELOW THE GRID */
    .controls {
      position: static;
      display: none;
      gap: 10px;
      z-index: 100;
      justify-content: center;
      margin-top: 15px;
      padding: 10px;
    }

    @media (min-width: 768px) {
      .mobile-controls {
        display: none;
      }

      .controls {
        display: flex;
      }
    }

    .control-btn {
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .control-btn:hover {
      background: var(--bg-secondary);
      border-color: var(--accent-color);
    }

    /* Common Components */
    h1, h2, h3, h4 {
      font-family: 'Inter', sans-serif;
      margin: 0 0 16px 0;
      color: var(--text-primary);
      font-weight: 600;
    }

    h1 { font-size: 18px; }
    h2 { font-size: 16px; margin-bottom: 12px; }
    h3 { font-size: 14px; margin-bottom: 8px; }

    .search-box {
      width: 100%;
      padding: 10px 12px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      color: var(--text-primary);
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      transition: all 0.2s ease;
    }

    @media (min-width: 768px) {
      h1 { font-size: 24px; }
      h2 { font-size: 18px; margin-bottom: 20px; }
      
      .search-box {
        width: 300px;
        padding: 12px 16px;
      }
    }

    .search-box:focus {
      outline: none;
      border-color: var(--accent-color);
    }

    /* Person Items */
    .person-item {
      padding: 12px;
      margin: 8px 0;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      background: var(--bg-primary);
    }

    .person-item:hover {
      border-color: var(--accent-color);
      transform: translateX(4px);
    }

    .heat-score {
      display: inline-block;
      background: var(--accent-color);
      color: var(--bg-primary);
      padding: 2px 6px;
      font-size: 10px;
      margin-left: 8px;
      font-weight: 600;
      border-radius: 3px;
    }

    .role {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    .status {
      font-size: 11px;
      color: var(--text-secondary);
      margin-top: 2px;
      font-weight: 500;
    }

    /* Timeline */
    .timeline-event {
      padding: 12px;
      margin: 8px 0;
      border-left: 3px solid var(--accent-color);
      background: var(--bg-primary);
      border-radius: 0 6px 6px 0;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .timeline-event:hover {
      background: var(--bg-secondary);
    }

    .timeline-date {
      font-weight: 600;
      font-size: 13px;
      margin-bottom: 4px;
    }

    .timeline-desc {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.4;
    }

    .x-link {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 11px;
      margin-top: 4px;
      display: block;
    }

    .x-link:hover {
      text-decoration: underline;
    }

    /* Filter Sections */
    .filter-section {
      margin: 20px 0;
    }

    .filter-options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }

    .filter-option {
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text-primary);
    }

    .filter-option.active {
      background: var(--accent-color);
      color: var(--bg-primary);
    }

    .heat-slider {
      width: 100%;
      margin: 10px 0;
    }

    /* Group Indicators */
    .group-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 6px;
    }

    .group-victim { background: var(--accent-color); }
    .group-family { background: #666666; }
    .group-security { background: #888888; }
    .group-tpusa { background: #aaaaaa; }
    .group-event { background: #cccccc; }
    .group-network { background: #dddddd; }
    .group-suspect { background: #777777; }
    .group-investigators { background: #999999; }

    .header-subtitle {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
    }

    @media (min-width: 768px) {
      .header-subtitle {
        font-size: 14px;
        margin-left: 10px;
      }
    }

    .header-link {
      color: var(--text-primary);
      text-decoration: none;
    }

    .header-link:hover {
      text-decoration: underline;
    }

    .credits {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
    }

    .credit-link {
      color: var(--text-primary);
      text-decoration: none;
      font-weight: 500;
    }

    .credit-link:hover {
      text-decoration: underline;
    }

    /* Hide map tab on mobile */
    @media (max-width: 767px) {
      .mobile-tab[data-tab="map"] {
        display: none;
      }
    }
  </style>
</head>
<body>
  <!-- START SCREEN -->
  <div id="startScreen">
    <div id="startCircle">FOR CHARLIE</div>
    <div style="font-size: 14px; color: var(--text-secondary); font-weight: 500;">Click to begin investigation</div>
  </div>

  <!-- MAIN DASHBOARD -->
  <div id="app">
    <!-- HEADER -->
    <div id="header" class="panel">
      <div style="display: flex; align-items: center; flex-wrap: wrap; gap: 8px;">
        <h1>CHARLIE KIRK INVESTIGATION</h1>
        <div class="header-subtitle">
          • Research by <a href="https://x.com/shogtongue" class="header-link" target="_blank" rel="noopener noreferrer">@shogtongue</a>
          • Additional Research by <a href="https://x.com/Piper_truth1" class="header-link" target="_blank" rel="noopener noreferrer">@Piper_truth1</a>
        </div>
      </div>
      <div class="header-controls">
        <input type="text" class="search-box" placeholder="Search people and events..." id="searchBox" aria-label="Search investigation data">
        <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
          <span class="theme-icon">🌙</span>
        </button>
      </div>
    </div>

    <!-- MOBILE TABS -->
    <div id="mobileTabs">
      <button class="mobile-tab" data-tab="people">People</button>
      <button class="mobile-tab active" data-tab="timeline">Timeline</button>
      <!-- Map tab removed on mobile -->
    </div>

    <!-- LEFT PANEL -->
    <div id="leftPanel" class="panel tab-content active" data-tab-content="timeline">
      <h2>TIMELINE</h2>
      <div id="timeline">
        <div class="timeline-event" data-date="2025-09-05">
          <div class="timeline-date">Sep 5, 2025</div>
          <div class="timeline-desc">Stagwell report leaks Israel reputation crisis roadmap</div>
          <a href="https://www.dropsitenews.com/p/leaked-israel-reputation-survey-research-mark-penn-stagwell?utm_source=publication-search" class="x-link" target="_blank" rel="noopener noreferrer">View thread →</a>
        </div>
        <div class="timeline-event" data-date="2025-09-08">
          <div class="timeline-date">Sep 8, 2025</div>
          <div class="timeline-desc">Jerusalem attack kills 6, highlighting security threats</div>
          <a href="https://www.timesofisrael.com/jerusalem-terror-attack-exposes-fresh-holes-in-reliance-on-west-bank-security-barrier/" class="x-link" target="_blank" rel="noopener noreferrer">View thread →</a>
        </div>
        <div class="timeline-event" data-date="2025-09-10">
          <div class="timeline-date">Sep 10, 2025 • 12:23:15 MT</div>
          <div class="timeline-desc">Charlie Kirk shot during UVU Q&A with Hunter Kozak</div>
          <a href="https://abcnews.go.com/US/charlie-kirk-shot-event-utah-university-jd-vance/story?id=125451514" class="x-link" target="_blank" rel="noopener noreferrer">View thread →</a>
        </div>
        <div class="timeline-event" data-date="2025-09-12">
          <div class="timeline-date">Sep 12, 2025</div>
          <div class="timeline-desc">Tyler Robinson arrested, charged with aggravated murder</div>
          <a href="https://www.pbs.org/newshour/nation/what-we-know-so-far-about-the-charlie-kirk-shooting-suspect" class="x-link" target="_blank" rel="noopener noreferrer">View thread →</a>
        </div>
        <div class="timeline-event" data-date="2025-09-13">
          <div class="timeline-date">Sep 13, 2025</div>
          <div class="timeline-desc">Initial investigation notes hit shakes U.S. conservatives</div>
          <a href="https://www.abc.net.au/news/2025-09-12/charlie-kirk-assassination-test-for-donald-trump/105765246" class="x-link" target="_blank" rel="noopener noreferrer">View thread →</a>
        </div>
        <div class="timeline-event" data-date="2025-09-29">
          <div class="timeline-date">Sep 29, 2025</div>
          <div class="timeline-desc">First ID of Consolidated Training Groups</div>
          <a href="https://x.com/Piper_truth1/status/1972472141661802760" class="x-link" target="_blank" rel="noopener noreferrer">View thread →</a>
        </div>
        <div class="timeline-event" data-date="2025-10-01">
          <div class="timeline-date">Oct 01, 2025</div>
          <div class="timeline-desc">First ID of Rick Cutler</div>
          <a href="https://x.com/Piper_truth1/status/1973433316234969154" class="x-link" target="_blank" rel="noopener noreferrer">View thread →</a>
        </div>
        <div class="timeline-event" data-date="2025-10-05">
          <div class="timeline-date">Oct 5, 2025</div>
          <div class="timeline-desc">Mega-thread connects security > OUR > LDS > trafficking networks</div>
          <a href="https://x.com/shogtongue/status/1974671213416042856" class="x-link" target="_blank" rel="noopener noreferrer">View thread →</a>
        </div>
        <div class="timeline-event" data-date="2025-10-17">
          <div class="timeline-date">Oct 17, 2025</div>
          <div class="timeline-desc">Video analysis proves security countdown coordination</div>
          <a href="https://x.com/shogtongue/status/1979107661288243489" class="x-link" target="_blank" rel="noopener noreferrer">View thread →</a>
        </div>
        <div class="timeline-event" data-date="2025-10-21">
          <div class="timeline-date">Oct 21, 2025</div>
          <div class="timeline-desc">New footage analysis reveals additional security movements</div>
          <a href="https://x.com/shogtongue/status/1980896905740833050" class="x-link" target="_blank" rel="noopener noreferrer">View thread →</a>
        </div>
      </div>

      <div class="filter-section">
        <h3>FILTER BY GROUP</h3>
        <div class="filter-options" id="groupFilters">
          <div class="filter-option active" data-group="all">All</div>
          <div class="filter-option" data-group="victim">Victim</div>
          <div class="filter-option" data-group="family">Family</div>
          <div class="filter-option" data-group="security">Security</div>
          <div class="filter-option" data-group="tpusa">TPUSA</div>
          <div class="filter-option" data-group="event">Event</div>
          <div class="filter-option" data-group="network">Network</div>
          <div class="filter-option" data-group="suspect">Suspect</div>
          <div class="filter-option" data-group="investigators">Investigators</div>
        </div>
      </div>

      <div class="filter-section">
        <h3>MINIMUM HEAT SCORE</h3>
        <input type="range" min="1" max="10" value="1" class="heat-slider" id="heatSlider" aria-label="Minimum heat score">
        <div style="font-size: 12px; text-align: center;">Heat: <span id="heatValue">1</span>/10</div>
      </div>

      <div class="credits">
        <h3>RESEARCH CREDITS</h3>
        <div style="font-size: 13px; line-height: 1.6;">
          Primary Investigation: <a href="https://x.com/shogtongue" class="credit-link" target="_blank" rel="noopener noreferrer">@shogtongue</a><br>
          Security Team IDs: <a href="https://x.com/Piper_truth1" class="credit-link" target="_blank" rel="noopener noreferrer">@Piper_truth1</a><br>
          LDS Network Research: <a href="https://x.com/TheLFLounge" class="credit-link" target="_blank" rel="noopener noreferrer">@TheLFLounge</a>
        </div>
      </div>
    </div>

    <!-- CENTER PANEL - NETWORK VISUALIZATION -->
    <div id="centerPanel" class="panel tab-content" data-tab-content="map">
      <div id="visualizationContainer">
        <canvas id="networkCanvas"></canvas>
        <div class="canvas-overlay" id="canvasOverlay"></div>
      </div>
      
      <!-- Desktop Controls - NOW BELOW THE GRID -->
      <div class="controls">
        <button class="control-btn" id="resetView">Reset View</button>
        <button class="control-btn" id="toggleLabels">Show Labels</button>
        <button class="control-btn" id="toggleConnections">Hide Connections</button>
      </div>

      <!-- Mobile Controls -->
      <div class="mobile-controls">
        <button class="control-pill" data-action="filter">
          <span class="icon">🔍</span>
          Filter
        </button>
        <button class="control-pill" data-action="search">
          <span class="icon">👥</span>  
          People
        </button>
        <button class="control-pill" data-action="reset">
          <span class="icon">🔄</span>
          Reset
        </button>
      </div>
    </div>

    <!-- RIGHT PANEL - DOSSIER & PEOPLE -->
    <div id="rightPanel" class="panel tab-content" data-tab-content="people">
      <h2>INVESTIGATION DOSSIER</h2>
      <div id="dossierContent">
        <p style="color: var(--text-secondary); font-size: 13px;">Select a person to view detailed information</p>
      </div>

      <h2 style="margin-top: 30px;">PEOPLE DATABASE</h2>
      <div id="peopleList">
        <!-- People will be populated by JavaScript -->
      </div>
    </div>

    <!-- BOTTOM PANEL - REMOVED -->
    <div id="bottomPanel" class="panel" style="display: none;">
      <!-- Investigator notes removed as requested -->
    </div>
  </div>

<script>
// COMPREHENSIVE INVESTIGATION DATA (Fixed and Updated)
const investigationData = {
  people: [
    // VICTIM (Only Charlie Kirk)
    {id: 0, name: "Charlie Kirk", group: "victim", heat: 1, role: "TPUSA Founder/CEO", status: "Deceased", title: "Victim", details: "Fatally shot at 12:23:15 PM MT during UVU event. Single bullet from rooftop. Central focus of investigation."},
    
    // FAMILY (Formerly classified as victim)
    {id: 1, name: "Erika Kirk", group: "family", heat: 7, role: "Wife, CEO & Chair of the Board", status: "Active", title: "Wife & CEO", details: "DoD contractor family. Dad helped install Israel's Iron Dome. Received calls post-shot from Mikey McCoy. Elected unanimously on September 18, 2025, to lead post-Charlie Kirk's death. Oversees operations and strategic direction."},
    {id: 2, name: "Mary Kirk", group: "family", heat: 1, role: "Family Member", status: "Active", title: "Family Member", details: "No specific event role; family mention only."},
    {id: 3, name: "Robert K. Kirk", group: "family", heat: 1, role: "Family Member", status: "Active", title: "Family Member", details: "No specific event role; family mention only."},
    {id: 4, name: "Kimberly Kirk", group: "family", heat: 1, role: "Family Member", status: "Active", title: "Family Member", details: "No specific event role; family mention only."},
    
    // SECURITY TEAM
    {id: 6, name: "Brian Harpole", group: "security", heat: 10, role: "Security Lead", status: "Missing", title: "Director, Consolidated Training Group", details: "Applied IFAK trauma kit. First responder. Security detail for Mikey McCoy/Erika Kirk after UVU. Countdown coordination observed."},
    {id: 7, name: "Rick Cutler", group: "security", heat: 10, role: "Security Guard", status: "Missing", title: "Retired Police Officer", details: "'Palm pistol guy'. OUR Guatemala connections. Brother confirmed involvement via FB. Appeared in Montana post-event."},
    {id: 8, name: "Dan Flood", group: "security", heat: 9, role: "Security Director", status: "Active", title: "TPUSA Security Director", details: "Countdown coordination observed. Stage manager during event. Multiple watch/phone checks."},
    {id: 9, name: "Blake", group: "security", heat: 7, role: "Security Guard", status: "Active", title: "Security Guard", details: "Listens to Dan's signals; presses earpiece. Checks watch with Dan. Helps carry Kirk."},
    {id: 10, name: "Justin", group: "security", heat: 4, role: "Security Guard", status: "Active", title: "Security Guard", details: "Presses earpiece; warns Hunter not to touch mic."},
    {id: 11, name: "Cooper", group: "security", heat: 5, role: "Security/Tech", status: "Active", title: "Security/Tech", details: "Adjusts mic height; warns Hunter."},
    {id: 12, name: "Blake Harruff", group: "security", heat: 7, role: "Guard/Tech", status: "Active", title: "Guard/Tech", details: "Adjusts mic; rushes speaker. Montana with Cutler."},
    {id: 13, name: "Unnamed Officer", group: "security", heat: 2, role: "Security", status: "Active", title: "Security", details: "Generic security presence."},
    
    // TPUSA INNER CIRCLE & BOARD
    {id: 14, name: "Mikey McCoy", group: "tpusa", heat: 10, role: "Chief of Staff", status: "Active", title: "TPUSA Chief of Staff", details: "Son of Pastor Rob McCoy. Observed making calls post-event. High suspicion. Continues hosting show."},
    {id: 15, name: "Blake Neff", group: "tpusa", heat: 8, role: "Co-host", status: "Active", title: "Charlie Kirk Show Co-host", details: "On phone during event. Unusual behavior observed. Defense video analysis shows inconsistencies."},
    {id: 16, name: "Andrew Kolvet", group: "tpusa", heat: 6, role: "Executive Producer/Co-host", status: "Active", title: "Executive Producer/Co-host", details: "Inner circle; absent from TPUSA site post-event. No direct suspicions. Continues show direction."},
    {id: 17, name: "Jack Posobiec", group: "tpusa", heat: 5, role: "TPUSA Ally", status: "Active", title: "TPUSA Ally", details: "Attended security conference with Gen. Mike Flynn. Front-runner for TPUSA 'throne.' Pro-Israel."},
    {id: 18, name: "TPUSA Board", group: "tpusa", heat: 4, role: "Organizational Leadership", status: "Active", title: "Organizational Leadership", details: "Legacy continuity post-event. Potential censorship of Kirk's notebooks."},
    {id: 19, name: "Maycee Crofts", group: "tpusa", heat: 3, role: "TPUSA Staff", status: "Active", title: "TPUSA Staff", details: "Handled microphone before assassination. Event coordination role."},
    
    // NEW TPUSA BOARD MEMBERS
    {id: 38, name: "Doug De Groote", group: "tpusa", heat: 4, role: "Board Member", status: "Active", title: "TPUSA Board Member", details: "Signed the announcement electing Erika Kirk; involved in governance."},
    {id: 39, name: "Mike Miller", group: "tpusa", heat: 4, role: "Board Member", status: "Active", title: "TPUSA Board Member", details: "Signed the announcement; key in decision-making for leadership transition."},
    {id: 40, name: "Tom Sodeika", group: "tpusa", heat: 4, role: "Board Member", status: "Active", title: "TPUSA Board Member", details: "Signed the announcement; focuses on organizational stability."},
    {id: 41, name: "David Engelhardt", group: "tpusa", heat: 4, role: "Board Member", status: "Active", title: "TPUSA Board Member", details: "Signed the announcement; supports financial and operational oversight."},
    {id: 42, name: "Bill Montgomery", group: "tpusa", heat: 6, role: "Founder & Board Member", status: "Active", title: "TPUSA Founder & Board Member", details: "Co-founder with Charlie Kirk; long-term governance role."},
    {id: 43, name: "Tyler Bowyer", group: "tpusa", heat: 5, role: "COO & Board Member", status: "Active", title: "TPUSA COO & Board Member", details: "Chief Operating Officer; handles day-to-day operations and board decisions."},
    {id: 44, name: "Rob McCoy", group: "tpusa", heat: 5, role: "Board Member", status: "Active", title: "TPUSA Board Member", details: "Pastor and advisor; involved in strategic and ideological direction. Father of Mikey McCoy."},
    
    // EVENT PERSONNEL
    {id: 20, name: "Terryl", group: "event", heat: 9, role: "Organizer", status: "Active", title: "Event Organizer", details: "Removed SD card post-incident. LDS connections. Phone with ops team. Critical evidence suppression suspicion."},
    {id: 21, name: "Frank Turek", group: "event", heat: 8, role: "Photographer", status: "Active", title: "Event Photographer", details: "Pointed at Losee Center roof at 6:28 (4 minutes before shot). Critical observation indicating prior knowledge."},
    {id: 22, name: "Hunter Kozak", group: "event", heat: 7, role: "Q&A Questioner", status: "Active", title: "Event Attendee", details: "'Mass shooters?' question triggered immediate chaos before shot. LDS connections observed."},
    {id: 24, name: "George Zinn", group: "event", heat: 2, role: "Attendee/Distraction Creator", status: "Active", title: "Attendee/Distraction Creator", details: "Attempts to create diversion pre-shot. Mormon/LDS connected."},
    {id: 26, name: "Phil Lyman", group: "event", heat: 8, role: "Attendee", status: "Active", title: "Attendee", details: "Present at event; seen with Charlie pre-shot. Post-assassination, coaching Jeb Jacobi on camera."},
    {id: 27, name: "Jason Behunin", group: "event", heat: 7, role: "Person of Interest", status: "Active", title: "Ex-cop", details: "In reserved area in red hat. Ex-cop."},
    {id: 28, name: "Jeb Jacobi", group: "event", heat: 5, role: "Student Speaker", status: "Active", title: "Student Speaker", details: "One of first students to speak up; coached by Phil Lyman post-event."},
    
    // NETWORK
    {id: 29, name: "Tim Ballard", group: "network", heat: 9, role: "OUR Founder", status: "Active", title: "Operation Underground Railroad Founder", details: "Security conference connections. LDS and anti-trafficking networks. OUR Guatemala operations overlap."},
    {id: 30, name: "Elder M. Russell Ballard", group: "network", heat: 2, role: "LDS Church Leader", status: "Deceased", title: "LDS Church Leader", details: "Acting President, Quorum of Twelve. Ties to Tim Ballard (severed publicly). Overlaps with LDS-CIA research."},
    {id: 31, name: "Gary Rabine", group: "network", heat: 7, role: "Mentors", status: "Active", title: "Mentors", details: "Mentor figure."},
    {id: 32, name: "David Horowitz", group: "network", heat: 5, role: "Mentors", status: "Active", title: "Mentors", details: "Mentor figure."},
    {id: 33, name: "Bill Montgomery", group: "network", heat: 6, role: "Mentors", status: "Active", title: "Mentors", details: "Mentor figure."},
    
    // INVESTIGATORS
    {id: 34, name: "@shogtongue", group: "investigators", heat: 0, role: "Primary Investigator", status: "Active", title: "Primary Investigator", details: "Mega-thread (Oct 5), timer thread (Oct 17), new footage (Oct 21). Primary investigation lead."},
    {id: 35, name: "@Piper_truth1", group: "investigators", heat: 0, role: "Security Team IDs", status: "Active", title: "Security Team IDs", details: "Identified security team (Oct 1 thread). Consolidated Training Group connections."},
    {id: 36, name: "@TheLFLounge", group: "investigators", heat: 0, role: "LDS-CIA Research", status: "Active", title: "LDS-CIA Research", details: "LDS-CIA web research."},
    
    // SUSPECT
    {id: 37, name: "Tyler Robinson", group: "suspect", heat: 10, role: "Official Shooter", status: "Incarcerated", title: "UVU Student", details: "Charged with aggravated murder. Lone shooter per official narrative. Anti-conservative motive cited."}
  ],

  connections: [
    {source: 0, target: 1, type: "family", weight: 8},
    {source: 0, target: 6, type: "security", weight: 9},
    {source: 0, target: 7, type: "security", weight: 9},
    {source: 0, target: 8, type: "security", weight: 8},
    {source: 0, target: 14, type: "employment", weight: 8},
    {source: 0, target: 15, type: "employment", weight: 7},
    {source: 0, target: 20, type: "organization", weight: 6},
    {source: 6, target: 7, type: "collaboration", weight: 9},
    {source: 6, target: 8, type: "coordination", weight: 7},
    {source: 7, target: 29, type: "affiliation", weight: 7},
    {source: 14, target: 15, type: "employment", weight: 7},
    {source: 14, target: 44, type: "family", weight: 8},
    {source: 20, target: 22, type: "LDS", weight: 5},
    {source: 21, target: 37, type: "evidence", weight: 6},
    {source: 26, target: 28, type: "coaching", weight: 5},
    {source: 29, target: 30, type: "personal", weight: 8},
    {source: 34, target: 35, type: "collaboration", weight: 7},
    {source: 42, target: 0, type: "founder", weight: 7},
    {source: 43, target: 0, type: "employment", weight: 6},
    {source: 44, target: 0, type: "board", weight: 6}
  ]
};

// GLOBAL STATE
let appState = {
  selectedPerson: 0,
  showLabels: false,
  showConnections: true,
  currentFilter: "all",
  minHeat: 1,
  zoomLevel: 1.0,
  offsetX: 0,
  offsetY: 0,
  currentView: 'desktop'
};

let networkViz;

// THEME TOGGLE FUNCTIONALITY
function setupThemeToggle() {
  const themeToggle = document.getElementById('themeToggle');
  const themeIcon = themeToggle.querySelector('.theme-icon');
  
  // Check for saved theme or prefer-color-scheme
  const savedTheme = localStorage.getItem('theme');
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  
  if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
    document.documentElement.setAttribute('data-theme', 'dark');
    themeIcon.textContent = '☀️';
  }
  
  themeToggle.addEventListener('click', function() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    
    if (currentTheme === 'dark') {
      document.documentElement.removeAttribute('data-theme');
      themeIcon.textContent = '🌙';
      localStorage.setItem('theme', 'light');
    } else {
      document.documentElement.setAttribute('data-theme', 'dark');
      themeIcon.textContent = '☀️';
      localStorage.setItem('theme', 'dark');
    }
    
    // Update visualization colors if needed
    if (networkViz) {
      networkViz.render();
    }
  });
}

// CANVAS-BASED VISUALIZATION
class NetworkVisualization {
  constructor() {
    this.canvas = document.getElementById('networkCanvas');
    this.ctx = this.canvas.getContext('2d');
    this.overlay = document.getElementById('canvasOverlay');
    this.nodes = [];
    this.connections = [];
    this.hoveredNode = null;
    this.selectedNode = null;
    
    this.setupCanvas();
    this.setupInteractions();
  }

  setupCanvas() {
    this.resize();
    window.addEventListener('resize', this.resize.bind(this));
  }

  resize() {
    const container = this.canvas.parentElement;
    this.canvas.width = container.clientWidth;
    this.canvas.height = container.clientHeight;
    this.render();
  }

  setupInteractions() {
    this.canvas.addEventListener('mousemove', this.handleMouseMove.bind(this));
    this.canvas.addEventListener('click', this.handleClick.bind(this));
    
    // Touch events for mobile
    this.canvas.addEventListener('touchstart', this.handleTouch.bind(this));
    this.canvas.addEventListener('touchmove', this.handleTouch.bind(this));
  }

  handleMouseMove(event) {
    const rect = this.canvas.getBoundingClientRect();
    const x = event.clientX - rect.left;
    const y = event.clientY - rect.top;

    this.hoveredNode = this.getNodeAt(x, y);
    this.render();
  }

  handleClick(event) {
    if (this.hoveredNode) {
      this.selectedNode = this.hoveredNode;
      showDossier(this.hoveredNode.id);
    }
  }

  handleTouch(event) {
    event.preventDefault();
    if (event.touches.length === 1) {
      const touch = event.touches[0];
      const rect = this.canvas.getBoundingClientRect();
      const x = touch.clientX - rect.left;
      const y = touch.clientY - rect.top;

      if (event.type === 'touchstart') {
        const node = this.getNodeAt(x, y);
        if (node) {
          this.selectedNode = node;
          showDossier(node.id);
        }
      }
    }
  }

  getNodeAt(x, y) {
    for (const node of this.nodes) {
      const distance = Math.sqrt(
        Math.pow(node.x - x, 2) + Math.pow(node.y - y, 2)
      );
      if (distance <= node.radius) {
        return node;
      }
    }
    return null;
  }

  render() {
    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
    
    // Render connections
    if (appState.showConnections) {
      this.renderConnections();
    }
    
    // Render nodes
    this.renderNodes();
    
    // Render labels
    if (appState.showLabels || this.hoveredNode) {
      this.renderLabels();
    }
  }

  renderNodes() {
    this.nodes.forEach(node => {
      this.ctx.beginPath();
      this.ctx.arc(node.x, node.y, node.radius, 0, 2 * Math.PI);
      
      // Color based on heat
      this.ctx.fillStyle = this.getHeatColor(node.heat);
      this.ctx.fill();
      
      // Border for selected/hovered nodes
      if (node === this.selectedNode) {
        this.ctx.strokeStyle = '#ff0000';
        this.ctx.lineWidth = 3;
        this.ctx.stroke();
      } else if (node === this.hoveredNode) {
        this.ctx.strokeStyle = '#000000';
        this.ctx.lineWidth = 2;
        this.ctx.stroke();
      }
    });
  }

  renderConnections() {
    this.connections.forEach(conn => {
      const source = this.nodes.find(n => n.id === conn.source);
      const target = this.nodes.find(n => n.id === conn.target);
      
      if (source && target) {
        this.ctx.beginPath();
        this.ctx.moveTo(source.x, source.y);
        this.ctx.lineTo(target.x, target.y);
        this.ctx.strokeStyle = `rgba(0, 0, 0, ${0.2 + conn.weight / 20})`;
        this.ctx.lineWidth = conn.weight / 5;
        this.ctx.stroke();
      }
    });
  }

  renderLabels() {
    this.ctx.fillStyle = '#000000';
    this.ctx.font = '11px Inter';
    this.ctx.textAlign = 'center';
    
    this.nodes.forEach(node => {
      if (node === this.hoveredNode || node === this.selectedNode || appState.showLabels) {
        this.ctx.fillText(
          `${node.name} (${node.heat}/10)`,
          node.x,
          node.y + node.radius + 15
        );
      }
    });
  }

  getHeatColor(heat) {
    const colors = [
      '#e8f5e8', '#c8e6c9', '#a5d6a7', '#81c784', // 1-4
      '#fff9c4', '#fff176', '#ffeb3b',             // 5-7  
      '#ffcdd2', '#ef9a9a', '#e57373'              // 8-10
    ];
    return colors[heat - 1] || colors[0];
  }

  updateData(people, connections) {
    this.nodes = people.map(person => ({
      ...person,
      x: this.canvas.width / 2,
      y: this.canvas.height / 2,
      radius: 5 + person.heat * 2
    }));
    
    this.connections = connections;
    this.layoutNodes();
    this.render();
  }

  layoutNodes() {
    // Simple circular layout for demo
    const centerX = this.canvas.width / 2;
    const centerY = this.canvas.height / 2;
    const radius = Math.min(centerX, centerY) * 0.7;
    
    this.nodes.forEach((node, index) => {
      const angle = (index / this.nodes.length) * 2 * Math.PI;
      node.x = centerX + radius * Math.cos(angle);
      node.y = centerY + radius * Math.sin(angle);
    });
  }
}

// START SCREEN & INITIALIZATION
document.getElementById('startScreen').addEventListener('click', function() {
  this.style.opacity = '0';
  setTimeout(() => {
    this.style.display = 'none';
    document.getElementById('app').style.opacity = '1';
    initializeDashboard();
  }, 1000);
});

function initializeDashboard() {
  networkViz = new NetworkVisualization();
  renderPeopleList();
  setupSearch();
  setupFilters();
  setupControls();
  setupMobileTabs();
  setupThemeToggle(); // ADD THEME TOGGLE
  showDossier(0);
  
  // Only show visualization on desktop/tablet
  if (window.innerWidth >= 768) {
    updateVisualization();
  }
}

function updateVisualization() {
  const filteredPeople = investigationData.people.filter(person => 
    (appState.currentFilter === "all" || person.group === appState.currentFilter) &&
    person.heat >= appState.minHeat
  );

  const filteredConnections = investigationData.connections.filter(conn => {
    const source = investigationData.people.find(p => p.id === conn.source);
    const target = investigationData.people.find(p => p.id === conn.target);
    return source && target && filteredPeople.includes(source) && filteredPeople.includes(target);
  });

  networkViz.updateData(filteredPeople, filteredConnections);
}

// DOSSIER SYSTEM
function showDossier(personId) {
  const person = investigationData.people.find(p => p.id === personId);
  if (!person) return;

  const connections = investigationData.connections.filter(conn => 
    conn.source === personId || conn.target === personId
  );
  
  let html = `
    <h3>${person.name}</h3>
    <div style="display: flex; align-items: center; gap: 8px; margin: 12px 0;">
      <span class="heat-score" style="background: var(--heat-${person.heat});">${person.heat}/10</span>
      <span class="group-indicator group-${person.group}"></span>
      <span style="font-size: 12px; color: var(--text-secondary);">${person.group.toUpperCase()}</span>
    </div>
    <div class="role">${person.title}</div>
    <div class="status">${person.status.toUpperCase()}</div>
    <p style="margin-top: 16px; font-size: 13px; line-height: 1.5;">${person.details}</p>
  `;
  
  if (connections.length > 0) {
    html += `<h4 style="margin-top: 24px;">CONNECTIONS</h4>`;
    connections.forEach(conn => {
      const otherId = conn.source === personId ? conn.target : conn.source;
      const otherPerson = investigationData.people.find(p => p.id === otherId);
      if (otherPerson) {
        html += `<div class="person-item" onclick="showDossier(${otherId})" role="button" tabindex="0">
          <span class="group-indicator group-${otherPerson.group}"></span>
          <strong>${otherPerson.name}</strong> 
          <span class="heat-score" style="background: var(--heat-${otherPerson.heat});">${otherPerson.heat}/10</span>
          <div class="role">${otherPerson.role}</div>
        </div>`;
      }
    });
  }
  
  document.getElementById('dossierContent').innerHTML = html;
  appState.selectedPerson = personId;
}

// PEOPLE LIST
function renderPeopleList() {
  const peopleList = document.getElementById('peopleList');
  let html = '';
  
  const sortedPeople = [...investigationData.people].sort((a, b) => b.heat - a.heat);
  
  sortedPeople.forEach(person => {
    html += `
      <div class="person-item" onclick="showDossier(${person.id})" role="button" tabindex="0">
        <span class="group-indicator group-${person.group}"></span>
        <strong>${person.name}</strong> 
        <span class="heat-score" style="background: var(--heat-${person.heat});">${person.heat}/10</span>
        <div class="role">${person.role}</div>
        <div class="status">${person.status}</div>
      </div>
    `;
  });
  
  peopleList.innerHTML = html;
}

// MOBILE TABS
function setupMobileTabs() {
  const tabs = document.querySelectorAll('.mobile-tab');
  const tabContents = document.querySelectorAll('.tab-content');
  
  tabs.forEach(tab => {
    tab.addEventListener('click', function() {
      const tabName = this.dataset.tab;
      
      // Update active tab
      tabs.forEach(t => t.classList.remove('active'));
      this.classList.add('active');
      
      // Show corresponding content
      tabContents.forEach(content => {
        content.classList.remove('active');
        if (content.dataset.tabContent === tabName) {
          content.classList.add('active');
        }
      });
    });
  });
}

// SEARCH FUNCTIONALITY
function setupSearch() {
  const searchBox = document.getElementById('searchBox');
  searchBox.addEventListener('input', function(e) {
    const term = e.target.value.toLowerCase();
    const people = document.querySelectorAll('.person-item');
    
    people.forEach(person => {
      const text = person.textContent.toLowerCase();
      person.style.display = text.includes(term) ? 'block' : 'none';
    });
  });
}

// FILTERS
function setupFilters() {
  const groupFilters = document.querySelectorAll('.filter-option');
  groupFilters.forEach(filter => {
    filter.addEventListener('click', function() {
      groupFilters.forEach(f => f.classList.remove('active'));
      this.classList.add('active');
      
      appState.currentFilter = this.dataset.group;
      if (window.innerWidth >= 768) {
        updateVisualization();
      }
    });
  });
  
  const heatSlider = document.getElementById('heatSlider');
  const heatValue = document.getElementById('heatValue');
  
  heatSlider.addEventListener('input', function() {
    appState.minHeat = parseInt(this.value);
    heatValue.textContent = this.value;
    if (window.innerWidth >= 768) {
      updateVisualization();
    }
  });
}

// CONTROLS
function setupControls() {
  document.getElementById('resetView').addEventListener('click', function() {
    appState.selectedPerson = 0;
    appState.zoomLevel = 1.0;
    if (window.innerWidth >= 768) {
      updateVisualization();
    }
    showDossier(0);
  });
  
  document.getElementById('toggleLabels').addEventListener('click', function() {
    appState.showLabels = !appState.showLabels;
    this.textContent = appState.showLabels ? 'Hide Labels' : 'Show Labels';
    if (window.innerWidth >= 768) {
      updateVisualization();
    }
  });
  
  document.getElementById('toggleConnections').addEventListener('click', function() {
    appState.showConnections = !appState.showConnections;
    this.textContent = appState.showConnections ? 'Hide Connections' : 'Show Connections';
    if (window.innerWidth >= 768) {
      updateVisualization();
    }
  });

  // Mobile controls
  document.querySelectorAll('.control-pill').forEach(btn => {
    btn.addEventListener('click', function() {
      const action = this.dataset.action;
      switch(action) {
        case 'filter':
          document.querySelector('.mobile-tab[data-tab="timeline"]').click();
          break;
        case 'search':
          document.querySelector('.mobile-tab[data-tab="people"]').click();
          break;
        case 'reset':
          appState.selectedPerson = 0;
          if (window.innerWidth >= 768) {
            updateVisualization();
          }
          showDossier(0);
          break;
      }
    });
  });
}

// Make functions globally available
window.showDossier = showDossier;
</script>
</body>
</html>
